{% extends "base.html" %}
{% block head %}
    <style>
    .node circle {
    fill: #fff;
    stroke: steelblue;
    stroke-width: 3px;
    }
    .node text {
    font: 12px sans-serif;
    }
    .link {
    fill: none;
    stroke: #eee;
    stroke-width: 2px;
    }
    </style>
{% endblock %}
{% block body %}
    <!-- load the d3.js library -->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    {# <script src="https://unpkg.com/vue"></script> #}
    <script src="{{ url_for('static', filename='vue.js')}}"></script>
    <script src="{{ url_for('static', filename='app.js')}}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.3/FileSaver.min.js"></script>
    {# <section class="section"> #}
        <div class="container">
            <div class="columns" id="app-4">
                <div class="column is-one-quarter">
                    <aside class="menu">
                        <p class="menu-label">
                            Applications
                            <div v-on:click="saveSVG">
                                <a class="button is-info">Save as SVG</a>
                            </div>
                        </p>

                        <ul class="menu-list">
                            <li v-for="(application,index) in applications" v-on:click="showSVG">

                               <a>{% raw %}{{index}}-{{application.name}}{% endraw %}</a>
                            </li>
                        </ul>
                    </aside>
                </div>
                <div class="column is-three-quarters">

                </div>

            </div>
        </div>
        <script>
        const app4 = new Vue({
            el: '#app-4',
            data: {
                applications: {{tree | safe}},
                renderedApplications: {}
            },
            methods: {
                showSVG: function(event) {
                    console.log("Here");
                    let index = parseInt(/(\d+)-.*/.exec(event.target.text));
                    if (!this.renderedApplications.hasOwnProperty(index)) {
                        console.log("No cache");
                        d3.select("svg").remove();
                        draw_tree(this.applications[index]);
                        this.renderedApplications[index] = d3.select("svg").node();
                    } else {
                        console.log("Cache");
                        d3.select("#app-4 > div.column.is-three-quarters").html(this.renderedApplications[index].outerHTML)
                    }
                },
                saveSVG: function(event) {

                    let css = d3.select("style").node();
                    let svg = d3.select("svg");
                    svgNode = svg.node();
                    svgNode.insertBefore(css, svgNode.firstChild);
                    let html = d3.select("svg")
                        .attr("title", "test2")
                        .attr("version", 1.1)
                        .attr("xmlns", "http://www.w3.org/2000/svg")
                        .node().outerHTML;
                    let blob = new Blob([html], {
                        type: "image/svg+xml"
                    });
                    saveAs(blob, "myProfile.svg");
                }
            }
        })
        </script>
    {# </section> #}

{% endblock %}